# PixEcom v2.0 - CDN Architecture

## ğŸŒ Global Distribution Architecture

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   Users Worldwide   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    DNS Resolution   â”‚
                              â”‚  (Route 53 / DNS)   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    â”‚                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Edge Location    â”‚  â”‚    Edge     â”‚  â”‚  Edge Location    â”‚
          â”‚   (US East)       â”‚  â”‚  (Europe)   â”‚  â”‚    (Asia)         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                    â”‚                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  CloudFront (CDN)   â”‚
                              â”‚  - Cache            â”‚
                              â”‚  - WAF              â”‚
                              â”‚  - HTTPS            â”‚
                              â”‚  - Compression      â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                      â”‚                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Web Origin      â”‚  â”‚   API Origin    â”‚  â”‚   S3 Origin       â”‚
        â”‚   (Next.js)       â”‚  â”‚   (NestJS)      â”‚  â”‚   (Static Assets) â”‚
        â”‚   Port 3000       â”‚  â”‚   Port 3001     â”‚  â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚   Infrastructure    â”‚
                  â”‚  - PostgreSQL DB    â”‚
                  â”‚  - Redis Cache      â”‚
                  â”‚  - Nginx Proxy      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Request Flow

### Scenario 1: First Request (Cache Miss)

```
User Request â†’ CloudFront Edge â†’ [Cache Miss] â†’ Origin Server
                     â†“
              Store in Cache (TTL based)
                     â†“
         Return to User (200-400ms)

Next Request â†’ CloudFront Edge â†’ [Cache Hit] â†’ Return to User (10-50ms) âš¡
```

### Scenario 2: Static Asset Request

```
User: GET /static/logo.png
  â†“
CloudFront Edge (nearest location)
  â†“
[Check Cache]
  â”œâ”€ Cache Hit (90% of requests) â†’ Return immediately (10-30ms)
  â””â”€ Cache Miss (10% of requests)
      â†“
    S3 Bucket
      â†“
    Cache for 30 days
      â†“
    Return to user
```

### Scenario 3: API Request (No Cache)

```
User: POST /api/orders
  â†“
CloudFront Edge
  â†“
[Skip Cache - API routes never cached]
  â†“
Forward to NestJS Origin (with all headers/cookies)
  â†“
Process Request
  â†“
Return Response
  â†“
CloudFront â†’ User (no caching)
```

## ğŸ¯ Path-Based Routing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CloudFront Distribution                    â”‚
â”‚  Domain: d1234567890abc.cloudfront.net                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”   â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
â”‚  /*   â”‚   â”‚/api/*  â”‚   â”‚/staticâ”‚
â”‚Defaultâ”‚   â”‚  API   â”‚   â”‚   S3  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚           â”‚            â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cache Behavior Matrix               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Path         â”‚ Cache    â”‚ Origin    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /            â”‚ 5 min    â”‚ Next.js   â”‚
â”‚ /api/*       â”‚ NONE     â”‚ NestJS    â”‚
â”‚ /static/*    â”‚ 30 days  â”‚ S3        â”‚
â”‚ /_next/...   â”‚ 30 days  â”‚ Next.js   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Layer 1: DNS/Network            â”‚
â”‚  - DDoS Protection (AWS Shield)          â”‚
â”‚  - Geographic restrictions (optional)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Layer 2: WAF (Firewall)           â”‚
â”‚  - Rate limiting (2000 req/5min/IP)      â”‚
â”‚  - OWASP Top 10 protection               â”‚
â”‚  - Known bad input blocking              â”‚
â”‚  - SQL injection prevention              â”‚
â”‚  - XSS prevention                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Layer 3: CloudFront Security        â”‚
â”‚  - HTTPS enforcement (TLS 1.2/1.3)       â”‚
â”‚  - Field-level encryption (optional)     â”‚
â”‚  - Origin Access Identity for S3         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Layer 4: Response Headers            â”‚
â”‚  - Strict-Transport-Security (HSTS)      â”‚
â”‚  - X-Content-Type-Options: nosniff       â”‚
â”‚  - X-Frame-Options: DENY                 â”‚
â”‚  - X-XSS-Protection: 1; mode=block       â”‚
â”‚  - Referrer-Policy: strict-origin        â”‚
â”‚  - CORS headers                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Layer 5: Application Security         â”‚
â”‚  - JWT authentication                    â”‚
â”‚  - RBAC authorization                    â”‚
â”‚  - Input validation                      â”‚
â”‚  - SQL injection prevention (Prisma)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Caching Strategy

### TTL (Time To Live) Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Content Type    â”‚ Default  â”‚ Minimum  â”‚ Maximum  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Routes      â”‚ 0s       â”‚ 0s       â”‚ 1s       â”‚
â”‚ HTML Pages      â”‚ 5min     â”‚ 0s       â”‚ 24h      â”‚
â”‚ Static Assets   â”‚ 30d      â”‚ 0s       â”‚ 365d     â”‚
â”‚ Images          â”‚ 30d      â”‚ 0s       â”‚ 365d     â”‚
â”‚ CSS/JS          â”‚ 30d      â”‚ 0s       â”‚ 365d     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cache Key Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Cache Key Formula                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  API Routes (/api/*)                       â”‚
â”‚    â†’ No caching                            â”‚
â”‚                                            â”‚
â”‚  Static Assets (/static/*, /_next/static/) â”‚
â”‚    â†’ URL only                              â”‚
â”‚    â†’ Compression (gzip/brotli)             â”‚
â”‚                                            â”‚
â”‚  Web Pages (/*)                            â”‚
â”‚    â†’ URL                                   â”‚
â”‚    + cart_session cookie                   â”‚
â”‚    + next-auth.session-token cookie        â”‚
â”‚    + Accept-Language header                â”‚
â”‚    â†’ Compression (gzip/brotli)             â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸŒ Edge Locations

### PriceClass_100 (Default)
```
North America:
  ğŸ‡ºğŸ‡¸ United States (50+ locations)
  ğŸ‡¨ğŸ‡¦ Canada (5+ locations)

Europe:
  ğŸ‡¬ğŸ‡§ United Kingdom      ğŸ‡©ğŸ‡ª Germany
  ğŸ‡«ğŸ‡· France              ğŸ‡®ğŸ‡¹ Italy
  ğŸ‡ªğŸ‡¸ Spain               ğŸ‡³ğŸ‡± Netherlands
  ğŸ‡¸ğŸ‡ª Sweden              ğŸ‡®ğŸ‡ª Ireland
  And more...
```

### PriceClass_200 (Optional Upgrade)
```
All PriceClass_100 locations PLUS:

Asia:
  ğŸ‡¯ğŸ‡µ Japan               ğŸ‡¸ğŸ‡¬ Singapore
  ğŸ‡°ğŸ‡· South Korea         ğŸ‡­ğŸ‡° Hong Kong
  ğŸ‡®ğŸ‡³ India               ğŸ‡¹ğŸ‡¼ Taiwan

Middle East:
  ğŸ‡¦ğŸ‡ª UAE                 ğŸ‡®ğŸ‡± Israel

Africa:
  ğŸ‡¿ğŸ‡¦ South Africa
```

### PriceClass_All (Maximum Performance)
```
All PriceClass_200 locations PLUS:

South America:
  ğŸ‡§ğŸ‡· Brazil              ğŸ‡¦ğŸ‡· Argentina

Oceania:
  ğŸ‡¦ğŸ‡º Australia           ğŸ‡³ğŸ‡¿ New Zealand

Additional Asia Pacific locations
```

## ğŸ’¾ Storage Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         S3 Static Assets Bucket                 â”‚
â”‚  Name: pixecom-static-assets-{account-id}       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  /static/                                       â”‚
â”‚    â”œâ”€â”€ images/                                  â”‚
â”‚    â”‚   â”œâ”€â”€ products/                            â”‚
â”‚    â”‚   â”œâ”€â”€ logos/                               â”‚
â”‚    â”‚   â””â”€â”€ banners/                             â”‚
â”‚    â”œâ”€â”€ fonts/                                   â”‚
â”‚    â””â”€â”€ documents/                               â”‚
â”‚                                                 â”‚
â”‚  Security:                                      â”‚
â”‚    - Block all public access                    â”‚
â”‚    - Origin Access Identity (OAI) only          â”‚
â”‚    - Encryption: S3-managed (SSE-S3)            â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           S3 Logs Bucket                        â”‚
â”‚  Name: pixecom-cdn-logs-{account-id}            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  /cloudfront-logs/                              â”‚
â”‚    â””â”€â”€ YYYY/MM/DD/                              â”‚
â”‚        â””â”€â”€ [distribution-id].log.gz             â”‚
â”‚                                                 â”‚
â”‚  Lifecycle:                                     â”‚
â”‚    - 30 days: Move to IA storage                â”‚
â”‚    - 90 days: Delete                            â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Monitoring & Observability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CloudWatch Metrics                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Request Metrics:                              â”‚
â”‚    â€¢ Total Requests                            â”‚
â”‚    â€¢ Requests by Edge Location                 â”‚
â”‚    â€¢ HTTP Status Codes (2xx, 4xx, 5xx)         â”‚
â”‚                                                â”‚
â”‚  Performance Metrics:                          â”‚
â”‚    â€¢ Origin Latency                            â”‚
â”‚    â€¢ Cache Hit Ratio                           â”‚
â”‚    â€¢ Bytes Downloaded                          â”‚
â”‚    â€¢ Bytes Uploaded                            â”‚
â”‚                                                â”‚
â”‚  Error Metrics:                                â”‚
â”‚    â€¢ 4xx Error Rate                            â”‚
â”‚    â€¢ 5xx Error Rate                            â”‚
â”‚    â€¢ Origin Connection Errors                  â”‚
â”‚                                                â”‚
â”‚  Security Metrics (WAF):                       â”‚
â”‚    â€¢ Blocked Requests                          â”‚
â”‚    â€¢ Rate Limit Violations                     â”‚
â”‚    â€¢ Rule Matches                              â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Access Logs                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Fields Logged:                                â”‚
â”‚    â€¢ Date & Time                               â”‚
â”‚    â€¢ Edge Location                             â”‚
â”‚    â€¢ Request Path                              â”‚
â”‚    â€¢ HTTP Status                               â”‚
â”‚    â€¢ User Agent                                â”‚
â”‚    â€¢ Referrer                                  â”‚
â”‚    â€¢ Client IP                                 â”‚
â”‚    â€¢ Cache Status (Hit/Miss)                   â”‚
â”‚    â€¢ Bytes Sent/Received                       â”‚
â”‚                                                â”‚
â”‚  Use Cases:                                    â”‚
â”‚    â€¢ Troubleshooting errors                    â”‚
â”‚    â€¢ Analyzing traffic patterns                â”‚
â”‚    â€¢ Identifying popular content               â”‚
â”‚    â€¢ Security auditing                         â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Deployment Pipeline

```
Developer                   AWS CDK                   AWS Services
    â”‚                          â”‚                          â”‚
    â”‚  1. Code Changes         â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚  2. npm run build        â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚  3. cdk deploy           â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚  4. Synthesize CFN       â”‚
    â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚  5. Create/Update Stack  â”‚
    â”‚                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                          â”‚                          â”‚
    â”‚                          â”‚  6. Deploy Resources     â”‚
    â”‚                          â”‚     - CloudFront         â”‚
    â”‚                          â”‚     - S3 Buckets         â”‚
    â”‚                          â”‚     - WAF                â”‚
    â”‚                          â”‚     - Policies           â”‚
    â”‚                          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                          â”‚                          â”‚
    â”‚  7. Deployment Complete  â”‚                          â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
    â”‚                          â”‚                          â”‚
    â”‚  8. Invalidate Cache     â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                          â”‚                          â”‚
    â”‚  9. Test Distribution    â”‚                          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
    â”‚                          â”‚                          â”‚
```

## ğŸ’° Cost Breakdown

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Monthly Cost Components                 â”‚
â”‚        (Based on PriceClass_100)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  CloudFront:                                   â”‚
â”‚    â€¢ First 10 TB/month:    $0.085/GB           â”‚
â”‚    â€¢ Next 40 TB/month:     $0.080/GB           â”‚
â”‚    â€¢ HTTP/HTTPS requests:  $0.0075-0.0100/10k  â”‚
â”‚                                                â”‚
â”‚  S3:                                           â”‚
â”‚    â€¢ Storage:              $0.023/GB/month     â”‚
â”‚    â€¢ GET requests:         $0.0004/1k requests â”‚
â”‚    â€¢ PUT requests:         $0.005/1k requests  â”‚
â”‚                                                â”‚
â”‚  WAF (Optional):                               â”‚
â”‚    â€¢ Web ACL:              $5.00/month         â”‚
â”‚    â€¢ Rules:                $1.00/rule/month    â”‚
â”‚    â€¢ Requests:             $0.60/million       â”‚
â”‚                                                â”‚
â”‚  Data Transfer:                                â”‚
â”‚    â€¢ CloudFront â†’ Users:   Included in CF cost â”‚
â”‚    â€¢ Origin â†’ CloudFront:  Free               â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Example: 1TB transfer, 10M requests, 100GB storage
  CloudFront:     ~$85
  S3:             ~$3
  WAF:            ~$15
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:          ~$103/month

With Free Tier (first 12 months):
  CloudFront:     FREE (1TB included)
  S3:             ~$3
  WAF:            ~$15
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total:          ~$18/month
```

## ğŸ“ Best Practices

### âœ… DO
- Use versioned filenames for static assets (`app.v123.js`)
- Set long cache TTLs for immutable content
- Enable compression (Gzip/Brotli)
- Monitor cache hit ratio (target >80%)
- Use S3 for large static files
- Invalidate cache after deployments
- Review CloudWatch metrics regularly
- Enable WAF for production

### âŒ DON'T
- Cache API responses (they're dynamic)
- Use query strings unnecessarily (affects caching)
- Forget to invalidate after deployments
- Skip monitoring setup
- Leave default secrets in production
- Ignore cost alerts
- Deploy without testing

---

**For implementation details, see [README.md](README.md)**
